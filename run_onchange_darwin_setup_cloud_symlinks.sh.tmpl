#!/bin/bash

# Do nothing if Library/CloudStorage does not exist
CLOUD_DIR="{{ .chezmoi.homeDir }}/Library/CloudStorage"
if [ ! -d "$CLOUD_DIR" ]; then
    exit 0
fi

echo "‚òÅÔ∏è  Checking CloudStorage directories..."

# Iterate through directories in CloudStorage
for target in "$CLOUD_DIR"/*; do
    if [ -d "$target" ]; then
        default_name=$(basename "$target")
        
        # Get user input (via TTY)
        if [ -c /dev/tty ]; then
            echo "---------------------------------------------------"
            echo "Found: $default_name"
            echo -n "üîó Create symlink for '$default_name'? [y/N]: "
            read answer < /dev/tty
            
            case "$answer" in
                [yY]*)
                    # Input link name
                    echo -n "üìù Enter link name [default: $default_name]: "
                    read input_name < /dev/tty
                    
                    # Use default name if input is empty
                    link_name="${input_name:-$default_name}"
                    link_path="{{ .chezmoi.homeDir }}/$link_name"
                    
                    ln -sFn "$target" "$link_path"
                    echo "‚úÖ Created: $link_path -> $target"
                    ;;
                *)
                    echo "‚è≠Ô∏è  Skipped: $default_name"
                    ;;
            esac
        else
            echo "Warning: No TTY available. Skipping '$default_name'."
        fi
    fi
done