#!/bin/bash

# Library/CloudStorageãŒå­˜åœ¨ã—ãªã„å ´åˆã¯ä½•ã‚‚ã—ãªã„
CLOUD_DIR="{{ .chezmoi.homeDir }}/Library/CloudStorage"
if [ ! -d "$CLOUD_DIR" ]; then
    exit 0
fi

echo "â˜ï¸  Checking CloudStorage directories..."

# CloudStorageå†…ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’èµ°æŸ»
for target in "$CLOUD_DIR"/*; do
    if [ -d "$target" ]; then
        default_name=$(basename "$target")
        
        # ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ã®å–å¾— (TTYçµŒç”±)
        if [ -c /dev/tty ]; then
            echo "---------------------------------------------------"
            echo "Found: $default_name"
            echo -n "ğŸ”— Create symlink for '$default_name'? [y/N]: "
            read answer < /dev/tty
            
            case "$answer" in
                [yY]*)
                    # ãƒªãƒ³ã‚¯åã®å…¥åŠ›
                    echo -n "ğŸ“ Enter link name [default: $default_name]: "
                    read input_name < /dev/tty
                    
                    # å…¥åŠ›ãŒç©ºãªã‚‰ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆåã‚’ä½¿ç”¨
                    link_name="${input_name:-$default_name}"
                    link_path="{{ .chezmoi.homeDir }}/$link_name"
                    
                    ln -sFn "$target" "$link_path"
                    echo "âœ… Created: $link_path -> $target"
                    ;;
                *)
                    echo "â­ï¸  Skipped: $default_name"
                    ;;
            esac
        else
            echo "Warning: No TTY available. Skipping '$default_name'."
        fi
    fi
done